<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Video Wall (4 cams)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 12px; }
    .status { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; margin: 8px 0; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .tile {
      border: 1px solid #ddd;
      border-radius: 10px;
      overflow: hidden;
      background: #fff;
    }
    .tileHeader {
      padding: 6px 10px;
      font-size: 12px;
      border-bottom: 1px solid #eee;
      display:flex;
      justify-content: space-between;
      align-items: center;
    }
    iframe {
      width: 100%;
      height: 360px;
      border: 0;
    }
    .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    input { padding: 6px 8px; }
    button { padding: 6px 10px; }
  </style>
</head>
<body>
  <h2 style="margin:0 0 8px 0;">Video Panel</h2>

  <div class="status" id="status">status: loading...</div>

  <div class="controls">
    <span style="font-size:12px; color:#666;">
      tip: query params 지원 → <code>?cams=cam0,cam1,cam2,cam3</code>
    </span>
    <label style="font-size:12px;">cams</label>
    <input id="camsInput" value="cam0,cam1,cam2,cam3" style="width:260px;"/>
    <button id="applyBtn">Apply</button>
  </div>

  <div class="grid" id="grid"></div>

  <script>
    (function () {
      const DEFAULT_HOST = "10.100.0.21";
      const host =
        (location.hostname && location.hostname !== "127.0.0.1" && location.hostname !== "localhost")
          ? location.hostname
          : DEFAULT_HOST;

      // MediaMTX WebRTC 웹 페이지 포트
      const webrtcBase = `http://${host}:8889`;

      const statusEl = document.getElementById("status");
      const grid = document.getElementById("grid");
      const camsInput = document.getElementById("camsInput");
      const applyBtn = document.getElementById("applyBtn");

      function parseCams() {
        const url = new URL(location.href);
        const q = url.searchParams.get("cams");
        const raw = (q && q.trim().length) ? q : camsInput.value;
        return raw.split(",").map(s => s.trim()).filter(Boolean);
      }

      function render() {
        const cams = parseCams();
        camsInput.value = cams.join(",");
        statusEl.textContent = `status: host=${host} | webrtcBase=${webrtcBase} | cams=${cams.join(",")}`;

        grid.innerHTML = cams.slice(0, 4).map((camName, idx) => {
          const src = `${webrtcBase}/${encodeURIComponent(camName)}`;
          return `
            <div class="tile">
              <div class="tileHeader">
                <div>cam: <b>${camName}</b></div>
                <a href="${src}" target="_blank" style="font-size:12px;">open</a>
              </div>
              <iframe
                src="${src}"
                allow="autoplay; camera; microphone"
              ></iframe>
            </div>
          `;
        }).join("");
      }

      applyBtn.onclick = () => {
        const cams = camsInput.value.split(",").map(s => s.trim()).filter(Boolean);
        const url = new URL(location.href);
        url.searchParams.set("cams", cams.join(","));
        history.replaceState({}, "", url.toString());
        render();
      };

      render();
    })();
  </script>
</body>
</html>
